<html>
<a href="../programblog.html" class = "page"> Go back </a>
<p>This iteration, I wrote all of the code for the Mia application (except what was provided by the TAs). One of the major features of Mia was the command line mode. This feature allows the program to perform filters on both single images and a stack of numbered images and then save them to an output file all from the command line by passing in arguments. This snippet of code is from the function runCmdLine(). It's a loop that parses each command line argument (after the the input filename). At this point, the input image is already loaded onto the canvas, so this block of code looks for arguments and performing their corresponding actions on the canvas. It does this by storing the argument inside the variable nextArg so that it can be easily referenced, and then looking for a match to one of the arguments using a series of if/else clauses. If nextArg matches one of the filter arguments like, for example, "-sharpen," it tries to perform the filter on the canvas. Some filters like sharpen require a parameter, and so the code first checks to see whether enough arguments were passed to the command line to accommodate a parameter. If so, it converts the next argument from the command line into a double (or whatever type of parameter is needed for the filter) and passes it in to the filter. The program continues iterating through each argument until it finds one that doesn't match any predefined argument. It then assumes that this argument is the output file name. Though the code isn't shown, it first checks to see whether the filename is valid, and then finally it calls saveCanvasToFile() to save the filtered image to the output file.</p>

<p>I'll point out a few stylistic features of the code, the first of which is uniform error handling. Each time the program encounters an error such as bad input, the program prints out a message explaining why the input was bad, calls displayHelpMessage(), and exits with a value of 1. The error messages are useful to the user so that he/she can learn how to correctly use the program to try again, and the exit value allows outside programs to test whether an error has occurred. The printing of the help message is wrapped in a function to avoid redundancy, as it is used many times.</p>

<p>Next, notice the comments. I included comments to document the intent of each block of code in plain English. I find it enjoyable to read through code that is documented in this way, and since I am writing code for a team to review, I thought this style would be helpful.</p>

<p>I tried to be as uniform as possible in dealing with each argument by handling it in the same way. Each argument looks for 0 or more parameters, checks for errors, performs the associated action, and if necessary exits the program (as is the case with compare and output file).</p>

<code><pre>
// perform image load
loadImageToCanvas();
<br>
// iterate through all arguments & perform filters
for (int i = 2; i < argc; i++) {
    nextArg = string(argv[i]);
<br>
    if (nextArg.compare("-h") == 0) {
        displayHelpMessage();
        continue;
    } else if (nextArg.compare("-sharpen") == 0) {
<br>
        if (argc <= i + 1) {
            cout << "Argument -sharpen requires 1 parameter" << endl;
            displayHelpMessage();
            exit(1);
        } else if (inFilename.compare(" ")){
            i++;
            double value = atof(argv[i]);
            m_filterParameters.sharpen_amount = value;
            applyFilterSharpen();
        }
<br>
    } else if (nextArg.compare("-edgedetect") == 0) {
        <br>
        ...
<br>
    } else if (nextArg.compare("-thresh") == 0) {
        <br>
        ...
<br>
    } else if (nextArg.compare("-quantize") == 0) {
        <br>
        ...
<br>
    } else if (nextArg.compare("-blur") == 0) {
        <br>
        ...
<br>
    } else if (nextArg.compare("-saturate") == 0) {
        <br>
        ...
<br>
    } else if (nextArg.compare("-multrgb") == 0) {
<br>
        ...
<br>
    } else if (nextArg.compare("-compare") == 0) {
        <br>
        ...
<br>
    } else { // out-file name
<br>
        // generate out-filename
        ...
<br>
        // save file
        m_fileName = outFilename + outFileExtension;
        saveCanvasToFile();
        break;
    }
} // end for-loop

</pre></code>

<a href="../programblog.html" class = "page"> Go back to Program Blog Page</a>
</html>